<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Sistema de Reclutamiento</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            200: '#bfdbfe',
                            300: '#93c5fd',
                            400: '#60a5fa',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                            800: '#1e40af',
                            900: '#1e3a8a',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-primary-50 via-white to-blue-50 min-h-screen">
    <div id="app" x-data="loginApp()" x-init="init()">
        <!-- Main Container -->
        <div class="min-h-screen flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
            <div class="max-w-md w-full space-y-8">
                <!-- Header -->
                <div class="text-center">
                    <div class="mx-auto h-20 w-20 gradient-primary rounded-xl flex items-center justify-center shadow-2xl mb-6">
                        <i class="fas fa-users text-white text-2xl"></i>
                    </div>
                    <h2 class="text-3xl font-bold text-gray-900 mb-2">Sistema de Reclutamiento</h2>
                    <p class="text-gray-600">Ingresa a tu cuenta para continuar</p>
                </div>

                <!-- Login Form -->
                <form @submit.prevent="handleLogin()" class="mt-8 space-y-6">
                    <div class="bg-white rounded-2xl shadow-xl p-8 space-y-6">
                        <!-- Role Selection -->
                        <div x-show="!showLoginForm" x-transition class="space-y-4">
                            <h3 class="text-lg font-semibold text-gray-900 text-center mb-6">Selecciona tu rol</h3>
                            <div class="grid gap-4">
                                <!-- Director Role -->
                                <div @click="selectRole('director')" 
                                     :class="selectedRole === 'director' ? 'ring-2 ring-primary-500 bg-primary-50' : 'hover:bg-gray-50'"
                                     class="p-4 border-2 border-gray-200 rounded-xl cursor-pointer transition-all group">
                                    <div class="flex items-center space-x-4">
                                        <div class="w-12 h-12 gradient-primary rounded-lg flex items-center justify-center">
                                            <i class="fas fa-crown text-white text-lg"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-gray-900">Director RH</h4>
                                            <p class="text-sm text-gray-600">Acceso completo al sistema</p>
                                        </div>
                                        <div class="ml-auto">
                                            <i class="fas fa-chevron-right text-gray-400 group-hover:text-primary-500 transition-colors"></i>
                                        </div>
                                    </div>
                                </div>

                                <!-- Supervisor Role -->
                                <div @click="selectRole('supervisor')" 
                                     :class="selectedRole === 'supervisor' ? 'ring-2 ring-primary-500 bg-primary-50' : 'hover:bg-gray-50'"
                                     class="p-4 border-2 border-gray-200 rounded-xl cursor-pointer transition-all group">
                                    <div class="flex items-center space-x-4">
                                        <div class="w-12 h-12 gradient-success rounded-lg flex items-center justify-center">
                                            <i class="fas fa-user-tie text-white text-lg"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-gray-900">Supervisor</h4>
                                            <p class="text-sm text-gray-600">Gestión de procesos y candidatos</p>
                                        </div>
                                        <div class="ml-auto">
                                            <i class="fas fa-chevron-right text-gray-400 group-hover:text-primary-500 transition-colors"></i>
                                        </div>
                                    </div>
                                </div>

                                <!-- Admin Role -->
                                <div @click="selectRole('admin')" 
                                     :class="selectedRole === 'admin' ? 'ring-2 ring-primary-500 bg-primary-50' : 'hover:bg-gray-50'"
                                     class="p-4 border-2 border-gray-200 rounded-xl cursor-pointer transition-all group">
                                    <div class="flex items-center space-x-4">
                                        <div class="w-12 h-12 gradient-warning rounded-lg flex items-center justify-center">
                                            <i class="fas fa-cog text-white text-lg"></i>
                                        </div>
                                        <div>
                                            <h4 class="font-semibold text-gray-900">Administrador</h4>
                                            <p class="text-sm text-gray-600">Configuración del sistema</p>
                                        </div>
                                        <div class="ml-auto">
                                            <i class="fas fa-chevron-right text-gray-400 group-hover:text-primary-500 transition-colors"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Login Form Fields -->
                        <div x-show="showLoginForm" x-transition class="space-y-6">
                            <!-- Back Button -->
                            <button @click="goBack()" type="button" class="flex items-center text-primary-600 hover:text-primary-700 transition-colors">
                                <i class="fas fa-arrow-left mr-2"></i>
                                <span class="text-sm">Cambiar rol</span>
                            </button>

                            <!-- Selected Role Display -->
                            <div class="flex items-center justify-center space-x-3 py-4">
                                <div class="w-10 h-10 rounded-lg flex items-center justify-center"
                                     :class="getRoleIconClass()">
                                    <i :class="getRoleIcon()" class="text-white"></i>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Ingresando como</p>
                                    <p class="font-semibold text-gray-900" x-text="getRoleDisplayName()"></p>
                                </div>
                            </div>

                            <!-- Username Field -->
                            <div>
                                <label for="username" class="block text-sm font-medium text-gray-700 mb-2">
                                    Usuario
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-user text-gray-400"></i>
                                    </div>
                                    <input id="username" 
                                           name="username" 
                                           type="text" 
                                           required
                                           x-model="loginForm.username"
                                           class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"
                                           placeholder="Ingresa tu usuario">
                                </div>
                            </div>

                            <!-- Password Field -->
                            <div>
                                <label for="password" class="block text-sm font-medium text-gray-700 mb-2">
                                    Contraseña
                                </label>
                                <div class="relative">
                                    <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                        <i class="fas fa-lock text-gray-400"></i>
                                    </div>
                                    <input id="password" 
                                           name="password" 
                                           :type="showPassword ? 'text' : 'password'" 
                                           required
                                           x-model="loginForm.password"
                                           class="block w-full pl-10 pr-10 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"
                                           placeholder="Ingresa tu contraseña">
                                    <button @click="showPassword = !showPassword" 
                                            type="button"
                                            class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                        <i :class="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'" 
                                           class="text-gray-400 hover:text-gray-600 transition-colors"></i>
                                    </button>
                                </div>
                            </div>

                            <!-- Remember Me & Forgot Password -->
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <input id="remember" 
                                           name="remember" 
                                           type="checkbox" 
                                           x-model="loginForm.remember"
                                           class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 rounded">
                                    <label for="remember" class="ml-2 block text-sm text-gray-700">
                                        Recordarme
                                    </label>
                                </div>
                                <div class="text-sm">
                                    <a href="#" class="text-primary-600 hover:text-primary-700 transition-colors">
                                        ¿Olvidaste tu contraseña?
                                    </a>
                                </div>
                            </div>

                            <!-- Login Button -->
                            <button type="submit" 
                                    :disabled="loading"
                                    class="group relative w-full flex justify-center py-3 px-4 border border-transparent text-sm font-medium rounded-lg text-white btn-primary focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-all disabled:opacity-50">
                                <span x-show="!loading">
                                    <i class="fas fa-sign-in-alt mr-2"></i>
                                    Iniciar Sesión
                                </span>
                                <span x-show="loading" class="flex items-center">
                                    <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"></div>
                                    Ingresando...
                                </span>
                            </button>
                        </div>
                    </div>
                </form>

                <!-- Demo Credentials -->
                <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-primary-500">
                    <h3 class="text-sm font-semibold text-gray-900 mb-3 flex items-center">
                        <i class="fas fa-info-circle text-primary-500 mr-2"></i>
                        Credenciales de Demostración
                    </h3>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Director:</span>
                            <span class="font-mono text-gray-900">director / admin123</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Supervisor:</span>
                            <span class="font-mono text-gray-900">supervisor / admin123</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Admin:</span>
                            <span class="font-mono text-gray-900">admin / admin123</span>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="text-center text-sm text-gray-500">
                    <p>&copy; 2024 Sistema de Reclutamiento. Todos los derechos reservados.</p>
                </div>
            </div>
        </div>

        <!-- Success Modal -->
        <div x-show="showSuccessModal" 
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div x-transition:enter="transition ease-out duration-300"
                 x-transition:enter-start="opacity-0 scale-95"
                 x-transition:enter-end="opacity-100 scale-100"
                 x-transition:leave="transition ease-in duration-200"
                 x-transition:leave-start="opacity-100 scale-100"
                 x-transition:leave-end="opacity-0 scale-95"
                 class="bg-white rounded-2xl shadow-2xl p-8 max-w-sm mx-4">
                <div class="text-center">
                    <div class="w-16 h-16 gradient-success rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-check text-white text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">¡Bienvenido!</h3>
                    <p class="text-gray-600 mb-6">Login exitoso. Redirigiendo al dashboard...</p>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-primary-600 h-2 rounded-full transition-all duration-300" 
                             :style="'width: ' + redirectProgress + '%'"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="api-client.js"></script>
    <script>
        function loginApp() {
            return {
                // State
                selectedRole: '',
                showLoginForm: false,
                showPassword: false,
                loading: false,
                showSuccessModal: false,
                redirectProgress: 0,
                
                // Form data
                loginForm: {
                    username: '',
                    password: '',
                    remember: false
                },
                
                // API client
                api: new RecruitmentAPI(),
                
                // Initialize
                init() {
                    // Check if already logged in
                    if (localStorage.getItem('authToken')) {
                        this.redirectToDashboard();
                    }
                },
                
                // Role selection
                selectRole(role) {
                    this.selectedRole = role;
                    this.showLoginForm = true;
                    
                    // Pre-fill demo credentials
                    switch(role) {
                        case 'director':
                            this.loginForm.username = 'director';
                            this.loginForm.password = 'admin123';
                            break;
                        case 'supervisor':
                            this.loginForm.username = 'supervisor';
                            this.loginForm.password = 'admin123';
                            break;
                        case 'admin':
                            this.loginForm.username = 'admin';
                            this.loginForm.password = 'admin123';
                            break;
                    }
                },
                
                goBack() {
                    this.showLoginForm = false;
                    this.selectedRole = '';
                    this.loginForm = {
                        username: '',
                        password: '',
                        remember: false
                    };
                },
                
                // Role helpers
                getRoleDisplayName() {
                    switch(this.selectedRole) {
                        case 'director': return 'Director RH';
                        case 'supervisor': return 'Supervisor';
                        case 'admin': return 'Administrador';
                        default: return '';
                    }
                },
                
                getRoleIcon() {
                    switch(this.selectedRole) {
                        case 'director': return 'fas fa-crown';
                        case 'supervisor': return 'fas fa-user-tie';
                        case 'admin': return 'fas fa-cog';
                        default: return 'fas fa-user';
                    }
                },
                
                getRoleIconClass() {
                    switch(this.selectedRole) {
                        case 'director': return 'gradient-primary';
                        case 'supervisor': return 'gradient-success';
                        case 'admin': return 'gradient-warning';
                        default: return 'bg-gray-400';
                    }
                },
                
                // Login handling
                async handleLogin() {
                    if (this.loading) return;
                    
                    this.loading = true;
                    
                    try {
                        // Simulate API call
                        await new Promise(resolve => setTimeout(resolve, 1500));
                        
                        // Mock successful login
                        const mockToken = 'mock_jwt_token_' + Date.now();
                        const mockUser = {
                            id: 1,
                            username: this.loginForm.username,
                            role: this.selectedRole,
                            name: this.getRoleDisplayName(),
                            email: `${this.loginForm.username}@company.com`
                        };
                        
                        // Store auth data
                        localStorage.setItem('authToken', mockToken);
                        localStorage.setItem('refreshToken', 'mock_refresh_' + Date.now());
                        localStorage.setItem('user', JSON.stringify(mockUser));
                        
                        // Show success modal and redirect
                        this.showSuccessModal = true;
                        this.startRedirectProgress();
                        
                        // In production, use real API:
                        // const response = await this.api.login(this.loginForm.username, this.loginForm.password);
                        // localStorage.setItem('authToken', response.access_token);
                        // localStorage.setItem('refreshToken', response.refresh_token);
                        // localStorage.setItem('user', JSON.stringify(response.user));
                        
                    } catch (error) {
                        console.error('Login error:', error);
                        NotificationManager.error('Credenciales inválidas');
                    } finally {
                        this.loading = false;
                    }
                },
                
                startRedirectProgress() {
                    const interval = setInterval(() => {
                        this.redirectProgress += 10;
                        if (this.redirectProgress >= 100) {
                            clearInterval(interval);
                            setTimeout(() => this.redirectToDashboard(), 500);
                        }
                    }, 100);
                },
                
                redirectToDashboard() {
                    const role = this.selectedRole || JSON.parse(localStorage.getItem('user') || '{}').role;
                    
                    switch(role) {
                        case 'director':
                            window.location.href = 'director-dashboard-v2.html';
                            break;
                        case 'supervisor':
                            // window.location.href = 'supervisor-dashboard.html';
                            NotificationManager.info('Dashboard de Supervisor en desarrollo');
                            break;
                        case 'admin':
                            // window.location.href = 'admin-dashboard.html';
                            NotificationManager.info('Dashboard de Admin en desarrollo');
                            break;
                        default:
                            window.location.href = 'director-dashboard-v2.html';
                    }
                }
            }
        }
    </script>
</body>
</html>